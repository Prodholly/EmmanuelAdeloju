<!doctype html>
<html>
  <head>
    {% include head.liquid %}

    <!-- Distill js -->
    <script src="{{ '/assets/js/distillpub/template.v2.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/distillpub/transforms.v2.js' | relative_url }}"></script>
    {% if page._styles %}
      <!-- Page/Post style -->
      <style type="text/css">
        {{ page._styles }}
      </style>
    {% endif %}
  </head>

  <d-front-matter>
    <script async type="text/json">
      {
        "title": "{{ page.title }}",
        "description": "{{ page.description }}",
        "published": "{{ page.date | date: '%B %d, %Y' }}",
        "authors": [
          {% for author in page.authors %}
          {
            "author": "{{ author.name }}",
            "authorURL": "{{ author.url }}",
            "affiliations": [
              {
                "name": "{{ author.affiliations.name }}",
                "url": "{{ author.affiliations.url }}"
              }
            ]
          }{% if forloop.last == false %},{% endif %}
          {% endfor %}
        ],
        "katex": {
          "delimiters": [
            { "left": "$", "right": "$", "display": false },
            { "left": "$$", "right": "$$", "display": true }
          ]
        }
      }
    </script>
  </d-front-matter>

  <body class="{% if site.navbar_fixed %}fixed-top-nav{% endif %} {% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">
    <!-- Header -->
    {% include header.liquid %}

    <!-- Content -->
    <div class="post distill">
      <d-title>
        <p class="module-label">Module {{ page.module_number }}</p>
        <h1>{{ page.title }}</h1>
        <p>{{ page.description }}</p>
      </d-title>

      {% if page.authors %}
        <d-byline></d-byline>
      {% endif %}

      <d-article>
        <!-- Table of Contents -->
        <d-contents>
          <nav class="l-text figcaption">
            <h3>Contents</h3>
            {% toc %}
          </nav>
        </d-contents>

        <!-- Module Content -->
        {{ content }}

        <!-- Module Navigation -->
        <div class="module-nav-section">
          {% assign sorted_modules = site.modules | sort: "module_number" %}
          {% assign current_index = nil %}
          {% for mod in sorted_modules %}
            {% if mod.url == page.url %}
              {% assign current_index = forloop.index0 %}
            {% endif %}
          {% endfor %}

          {% if current_index != nil %}
            {% assign prev_index = current_index | minus: 1 %}
            {% assign next_index = current_index | plus: 1 %}

            <div class="module-nav-buttons">
              {% if prev_index >= 0 %}
                {% assign prev_module = sorted_modules[prev_index] %}
                <a href="{{ prev_module.url | relative_url }}" class="module-nav-btn module-nav-prev">
                  <span class="nav-direction"><i class="fa-solid fa-arrow-left"></i> Previous</span>
                  <span class="nav-module-title">Module {{ prev_module.module_number }}: {{ prev_module.short_title | default: prev_module.title }}</span>
                </a>
              {% else %}
                <div class="module-nav-btn module-nav-prev disabled"></div>
              {% endif %}

              {% if next_index < sorted_modules.size %}
                {% assign next_module = sorted_modules[next_index] %}
                <a href="{{ next_module.url | relative_url }}" class="module-nav-btn module-nav-next">
                  <span class="nav-direction">Next <i class="fa-solid fa-arrow-right"></i></span>
                  <span class="nav-module-title">Module {{ next_module.module_number }}: {{ next_module.short_title | default: next_module.title }}</span>
                </a>
              {% else %}
                <div class="module-nav-btn module-nav-next disabled"></div>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </d-article>

      <!-- Right Sidebar: All Modules -->
      <div class="module-sidebar">
        <h4>All Modules</h4>
        <ul class="module-sidebar-list">
          {% assign sorted_modules = site.modules | sort: "module_number" %}
          {% for mod in sorted_modules %}
            <li class="{% if mod.url == page.url %}active{% endif %}">
              <a href="{{ mod.url | relative_url }}">
                <span class="sidebar-mod-num">{{ mod.module_number }}</span>
                <span class="sidebar-mod-title">{{ mod.short_title | default: mod.title }}</span>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      {% if page.bibliography %}
        <d-bibliography src="{{ page.bibliography | prepend: '/assets/bibliography/' | relative_url }}"></d-bibliography>
      {% endif %}
    </div>

    <!-- Footer -->
    {% include footer.liquid %}

    <!-- JavaScripts -->
    {% include distill_scripts.liquid %}
  </body>
</html>
